name: üìä Profile Dashboard Update

on:
  workflow_dispatch: # üîÑ Allow manual trigger
  schedule:
    - cron: '0 0 */3 * *' # ‚è∞ Run every 3 days at midnight UTC

jobs:
  update-profile:
    name: üîÑ Update GitHub Profile Dashboard
    runs-on: ubuntu-latest
    permissions:
      contents: write
    timeout-minutes: 30
    steps:
      - name: üîç Validate Required Secrets
        run: |
          missing_secrets=()
          
          # Check WakaTime related secrets
          if [ -z "${{ secrets.WAKATIME_API_KEY }}" ]; then
            missing_secrets+=("WAKATIME_API_KEY")
          fi
          
          # Check GitHub related secrets
          if [ -z "${{ secrets.GITHUB_TOKEN }}" ]; then
            missing_secrets+=("GITHUB_TOKEN")
          fi
          
          if [ -z "${{ secrets.GH_TOKEN }}" ]; then
            missing_secrets+=("GH_TOKEN")
          fi
          
          if [ -z "${{ secrets.GH_EMAIL }}" ]; then
            missing_secrets+=("GH_EMAIL")
          fi
          
          if [ -z "${{ secrets.GH_USERNAME }}" ]; then
            missing_secrets+=("GH_USERNAME")
          fi

          if [ -z "${{ secrets.GH_ACTOR }}" ]; then
            missing_secrets+=("GH_ACTOR")
          fi
          
          # Show error if any secrets are missing
          if [ ${#missing_secrets[@]} -ne 0 ]; then
            echo "‚ùå Error: The following required secrets are missing: ${missing_secrets[*]}"
            echo "Please define them in the repository settings."
            exit 1
          fi
          
          echo "‚úÖ All required secrets are defined."
          
      - name: üì• Checkout Repository
        uses: actions/checkout@v4

      - name: üìä Update README with WakaTime Stats
        uses: anmol098/waka-readme-stats@master
        timeout-minutes: 20
        continue-on-error: false
        env:
          WAKATIME_API_KEY: ${{ secrets.WAKATIME_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GH_ACTOR: ${{ secrets.GH_ACTOR }}
          GH_EMAIL: ${{ secrets.GH_EMAIL }}
        with:
          WAKATIME_API_KEY: ${{ secrets.WAKATIME_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          SHOW_LINES_OF_CODE: "False"
          SHOW_PROFILE_VIEWS: "False"
          SHOW_COMMIT: "True"
          SHOW_DAYS_OF_WEEK: "True"
          SHOW_LANGUAGE: "True"
          SHOW_OS: "True"
          SHOW_PROJECTS: "True" 
          SHOW_EDITORS: "True"
          SHOW_LANGUAGE_PER_REPO: "True"
          SHOW_SHORT_INFO: "True"
          SHOW_LOC_CHART: "True"
          SHOW_UPDATED_DATE: "False"
          SHOW_TOTAL_CODE_TIME: "True"
          SHOW_TIMEZONE: "False"
          COMMIT_MESSAGE: "chore(update): update README.md with WakaTime Stats"
          IGNORED_REPOS: "['devalexanderdaza/devalexanderdaza']" # Ignore own repository
          COMMIT_SINGLE: "True"
          COMMIT_EMAIL: "${{ secrets.GH_EMAIL }}"
          COMMIT_USERNAME: "${{ secrets.GH_ACTOR }}"
      
      - name: üìß Notify Result
        run: |
          STATUS="${{ job.status }}"
          echo "::notice ::Workflow completado con estado: $STATUS"
          
          # Puedes expandir esta secci√≥n para enviar notificaciones 
          # por correo o a servicios como Slack, Discord, etc.
          
          if [ "$STATUS" = "success" ]; then
            echo "‚úÖ Profile updated successfully!"
          elif [ "$STATUS" = "failure" ]; then
            echo "‚ùå Profile update failed!"
          elif [ "$STATUS" = "cancelled" ]; then
            echo "‚ö†Ô∏è Profile update was cancelled!"
          fi